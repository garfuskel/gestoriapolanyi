<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P√®rdues i Guanys - CONTRA-RELLOTGE</title>
<style>
    /* --- ESTILS GENERALS --- */
    body { 
        font-family: 'Segoe UI', Arial, sans-serif; 
        background: #f0f2f5; 
        padding: 20px; 
        color: #333; 
        margin: 0; 
        margin-top: 40px; /* Espai per la barra de temps gran */
    }

    /* --- BARRA DE TEMPS (GRAN I VISIBLE) --- */
    #timer-container { 
        width: 100%; 
        background-color: #e2e8f0; 
        height: 30px; 
        position: fixed; 
        top: 0; 
        left: 0; 
        z-index: 1000; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.2); 
    }
    #timer-bar { 
        width: 100%; 
        height: 100%; 
        background-color: #48bb78; 
        transition: width 1s linear, background-color 0.3s; 
    }

    /* --- CAP√áALERA D'INFORMACI√ì --- */
    h1 { text-align: center; color: #2c3e50; margin-bottom: 5px; margin-top: 10px; }
    
    .stats-bar {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 20px;
        font-size: 1.2rem;
        background: white;
        padding: 10px;
        border-radius: 50px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        width: fit-content;
        margin-left: auto;
        margin-right: auto;
    }
    .stat-item { font-weight: bold; color: #2c3e50; }
    .stat-value { color: #e67e22; }

    /* --- LAYOUT DEL JOC --- */
    .main-container { display: flex; gap: 20px; justify-content: center; align-items: flex-start; }
    
    /* COLUMNA DE COMPTES (ORIGEN) */
    .source-column { 
        background: white; 
        padding: 15px; 
        border-radius: 10px; 
        width: 300px; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        position: sticky;
        top: 60px;
    }

    /* COLUMNA DEL DOCUMENT (DEST√ç) */
    .document-column { 
        background: white; 
        padding: 25px; 
        border-radius: 10px; 
        width: 650px; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
    }

    /* ESTILS FITXES */
    .account { 
        background: #fff3cd; 
        color: #856404;
        padding: 10px 12px; 
        margin: 8px 0; 
        border-radius: 4px; 
        cursor: grab; 
        border: 1px solid #ffeeba; 
        font-size: 0.95em; 
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        display: flex; justify-content: space-between; align-items: center;
        transition: transform 0.1s;
    }
    .account:active { cursor: grabbing; transform: scale(0.98); }
    .account.dragging { opacity: 0.5; }
    .account-val { font-weight: bold; color: #555; font-family: monospace; font-size: 1.1em;}

    /* ESTILS DOCUMENT PYG */
    .pyg-section { margin-bottom: 15px; border: 1px solid #cbd5e0; border-radius: 6px; overflow: hidden; }
    .section-header { 
        background: #edf2f7; 
        padding: 10px; 
        font-weight: bold; 
        color: #2d3748; 
        border-bottom: 1px solid #cbd5e0;
        display: flex; justify-content: space-between;
        font-size: 0.95em;
    }
    .dropzone { 
        min-height: 50px; background: #fafafa; padding: 10px; transition: 0.2s; 
    }
    .dropzone.dragover { background: #ebf8ff; box-shadow: inset 0 0 10px #bee3f8; }

    /* RESULTATS INTERMEDIS */
    .result-row {
        background: #2c3e50; color: white;
        padding: 10px 15px; margin: 10px 0; border-radius: 6px;
        font-weight: bold; display: flex; justify-content: space-between; font-size: 1.05em;
    }
    .sub-result { background: #34495e; font-size: 0.95em; }
    
    /* BOTONS I FEEDBACK */
    .controls { text-align: center; margin-top: 20px; }
    button { 
        padding: 15px 30px; font-size: 18px; cursor: pointer; 
        background: #3498db; color: white; border: none; border-radius: 8px; 
        transition: 0.2s; font-weight: bold; box-shadow: 0 4px 0 #2980b9;
    }
    button:active { transform: translateY(4px); box-shadow: 0 0 0 #2980b9; }
    button:hover { background: #2980b9; }

    #feedback { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; text-align: left; }
    .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

    /* Estils espec√≠fics per diferenciar zones */
    .zone-ing { border-left: 5px solid #48bb78; } 
    .zone-des { border-left: 5px solid #f56565; }

    /* --- OVERLAYS (INICI I GAME OVER) --- */
    .overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(44, 62, 80, 0.98);
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        z-index: 5000; color: white; text-align: center;
    }
    .hidden { display: none !important; }
    .btn-start {
        background: #e67e22; color: white; padding: 20px 50px; font-size: 1.5rem;
        border: none; border-radius: 50px; cursor: pointer; font-weight: 900;
        box-shadow: 0 10px 20px rgba(0,0,0,0.3); transition: transform 0.2s; margin-top: 20px;
    }
    .btn-start:hover { transform: scale(1.05); background: #d35400; }

    /* --- GAME OVER CARD STYLE --- */
    .gameover-card {
        background: white; color: #333; padding: 40px; border-radius: 20px;
        max-width: 550px; width: 90%; box-shadow: 0 25px 60px rgba(0,0,0,0.6);
        position: relative;
        overflow: visible;
    }
    .rank-title { font-size: 2rem; font-weight: 900; color: #2c3e50; margin-bottom: 20px; text-transform: uppercase;}
    
    /* IMATGE AMB EFECTE TOP */
    .rank-img { 
        width: auto;
        max-width: 80%; 
        max-height: 300px;
        height: auto; 
        display: block;
        margin: 10px auto 30px auto; 
        transform: rotate(-3deg); 
        box-shadow: 15px 15px 30px rgba(0,0,0,0.3); 
        border: 8px solid white; 
        border-radius: 4px;
        transition: transform 0.3s ease;
    }
    .rank-img:hover {
        transform: rotate(0deg) scale(1.02); 
    }
    
    @media (max-width: 900px) {
        .main-container { flex-direction: column; align-items: center; }
        .source-column, .document-column { width: 100%; max-width: 600px; position: static; max-height: none;}
    }
</style>
</head>
<body>

<div id="timer-container">
    <div id="timer-bar"></div>
</div>

<div id="start-overlay" class="overlay">
    <h1 style="color:white; font-size: 3rem; margin-bottom: 10px;">Compte de p√®rdues i guanys<br><span style="color:#f1c40f">MODE CONTRA-RELLOTGE</span></h1>
    <p style="font-size: 1.2rem; max-width: 600px; margin-bottom: 30px; line-height: 1.5;">
        Completa els comptes de p√®rdues i guanys sense errors<br>
        <b>Cada 2 encerts pujar√†s de nivell</b><br><br>
        ‚úÖ Encerts: <b>+60 segons</b><br>
        ‚ùå Errors: <b>-5 segons</b>
    </p>
    <button class="btn-start" onclick="startGame()">COMEN√áAR</button>
</div>

<div id="gameover-overlay" class="overlay hidden">
    <div class="gameover-card">
        <h1 style="color:#e74c3c; margin-top:0; font-size: 2.5rem;">S'HA ACABAT EL TEMPS</h1>
        <div class="rank-title" id="final-rank-title">NIVELL 0: Becari</div>
        
        <img id="final-rank-img" src="" class="rank-img" alt="Imatge de rang">
        
        <p style="font-size: 1.3rem; margin: 10px 0;">
            Has tancat <b id="final-score" style="color:#2c3e50; font-size: 1.5em;">0</b> comptes de p√®rdues i guanys correctament
        </p>
        <button class="btn-start" style="font-size: 1.2rem; padding: 15px 40px; margin-top: 10px;" onclick="location.reload()">TORNAR A PROVAR</button>
    </div>
</div>

<h1>Compte de P√®rdues i Guanys</h1>

<div class="stats-bar">
    <div class="stat-item">RANG: <span id="rank-display" class="stat-value">Becari</span></div>
    <div class="stat-item">EXPEDIENTS: <span id="score-display" class="stat-value">0</span></div>
</div>

<div class="main-container">
    <div class="source-column">
        <h3 style="margin-top:0;">Comptes</h3>
        <div id="source-container" class="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    </div>

    <div class="document-column">
        
        <div class="pyg-section zone-ing">
            <div class="section-header">
                <span>1. INGRESSOS D'EXPLOTACI√ì (+)</span>
                <span id="total-ing-exp">0 ‚Ç¨</span>
            </div>
            <div id="zone-ing-exp" class="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" data-zone="ing_exp"></div>
        </div>

        <div class="pyg-section zone-des">
            <div class="section-header">
                <span>2. DESPESES D'EXPLOTACI√ì (-)</span>
                <span id="total-des-exp">0 ‚Ç¨</span>
            </div>
            <div id="zone-des-exp" class="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" data-zone="des_exp"></div>
        </div>

        <div class="result-row">
            <span>A) BAII (RESULTAT D'EXPLOTACI√ì)</span>
            <span id="val-baii">0 ‚Ç¨</span>
        </div>

        <div class="pyg-section zone-ing">
            <div class="section-header">
                <span>3. INGRESSOS FINANCERS (+)</span>
                <span id="total-ing-fin">0 ‚Ç¨</span>
            </div>
            <div id="zone-ing-fin" class="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" data-zone="ing_fin"></div>
        </div>

        <div class="pyg-section zone-des">
            <div class="section-header">
                <span>4. DESPESES FINANCERES (-)</span>
                <span id="total-des-fin">0 ‚Ç¨</span>
            </div>
            <div id="zone-des-fin" class="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" data-zone="des_fin"></div>
        </div>

        <div class="result-row sub-result">
            <span>B) RESULTAT FINANCER</span>
            <span id="val-res-fin">0 ‚Ç¨</span>
        </div>

        <div class="result-row">
            <span>C) BAI (RESULTAT ABANS D'IMPOSTOS)</span>
            <span id="val-bai">0 ‚Ç¨</span>
        </div>

        <div class="pyg-section zone-des">
            <div class="section-header">
                <span>5. IMPOST SOBRE BENEFICIS (-)</span>
                <span id="total-imp">0 ‚Ç¨</span>
            </div>
            <div id="zone-imp" class="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" data-zone="imp"></div>
        </div>

        <div class="result-row" style="background: #2c3e50;">
            <span>D) BN (RESULTAT DE L'EXERCICI)</span>
            <span id="val-bn">0 ‚Ç¨</span>
        </div>

        <div class="controls">
            <button onclick="checkResult()">‚úÖ COMPROVAR I SEGUIR</button>
        </div>
        <div id="feedback"></div>

    </div>
</div>

<script>
    // === CONFIGURACI√ì DEL JOC ===
    const ranks = [
        "Becari", 
        "Auxiliar", 
        "Administratiu", 
        "Comptable", 
        "Cap de Comptabilitat", 
        "Auditor J√∫nior", 
        "Auditor S√®nior", 
        "Controller", 
        "Director Financer", 
        "CFO", 
        "Mestre dels Balan√ßos"
    ];

    const START_TIME = 120;
    const BONUS_TIME = 60; 
    const PENALTY_TIME = 5; 
    const MAX_TIME = 120; 

    let timeLeft = START_TIME;
    let timerInterval;
    let isPlaying = false;
    
    // Progressi√≥
    let currentLevel = 0;
    let correctCount = 0; 
    let progressInLevel = 0; 

    // === 1. TOTS ELS COMPTES DE P√àRDUES I GUANYS POSSIBLES ===
    const pygDatabase = [
        { name: "Vendes de mercaderies", target: "ing_exp" },
        { name: "Ingressos per Prestacions de serveis", target: "ing_exp" },
        { name: "Devolucions de compres", target: "ing_exp" },
        { name: "R√†pels per compres", target: "ing_exp" },
        { name: "Descomptes sobre compres per pagament immediat", target: "ing_exp" }, 
        { name: "Ingressos per arrendaments", target: "ing_exp" },
        { name: "Variaci√≥ d'exist√®ncies (Ef > Ei)", target: "ing_exp" }, // VAR POS

        { name: "Compres de mercaderies", target: "des_exp" },
        { name: "Compres de primeres mat√®ries", target: "des_exp" },
        { name: "Devolucions de vendes", target: "des_exp" },
        { name: "R√†pels sobre vendes", target: "des_exp" },
        { name: "Descomptes sobre vendes per pagament immediat", target: "des_exp" },
        { name: "Arrendaments i c√†nons", target: "des_exp" },
        { name: "Serveis de professionals independents", target: "des_exp" },
        { name: "Transports", target: "des_exp" },
        { name: "Prima d'assegurances", target: "des_exp" },
        { name: "Reparaci√≥ i conservaci√≥", target: "des_exp" },
        { name: "Subministraments", target: "des_exp" },
        { name: "Altres tributs", target: "des_exp" },
        { name: "Sous i salaris", target: "des_exp" },
        { name: "Seguretat Social a c√†rrec empresa", target: "des_exp" },
        { name: "Serveis bancaris", target: "des_exp" },
        { name: "Variaci√≥ d'exist√®ncies (Ef < Ei)", target: "des_exp" }, // VAR NEG
        { name: "Amortitzaci√≥ de l'immobilitzat", target: "des_exp" },

        { name: "Altres ingressos financers", target: "ing_fin" },
        { name: "Interessos de deutes", target: "des_fin" },
        { name: "Impost sobre beneficis", target: "imp" }
    ];

    // === 2. TRAMPES (BALAN√á) ===
    const balanceSheetTraps = [
        "Propietat industrial", "Aplicacions inform√†tiques", "Amortitzaci√≥ acumulada de l'immobilitzat immaterial (AAII)",
        "Terrenys i b√©ns naturals", "Construccions", "Instal¬∑lacions t√®cniques", "Maquin√†ria",
        "Utillatge", "Mobiliari", "Equips per al proc√©s de la informaci√≥", "Elements de transport",
        "Amortitzaci√≥ acumulada de l'immobilitzat material (AAIM)", "Inversions en terrenys i b√©ns naturals",
        "Inversions en construccions", "Amortitzaci√≥ acumulada de les inversions immobili√†ries",
        "Inversions financeres a llarg termini en instruments de patrimoni", "Cr√®dits a llarg termini per alienaci√≥ d'immobilitzat",
        "Mercaderies", "Mat√®ries primeres", "Productes acabats", "Altres aprovisionaments",
        "Clients", "Clients, efectes comercials a cobrar", "Deutors", "Deutors, efectes comercials a cobrar",
        "Inversions financeres a curt termini en instruments de patrimoni", "Hisenda p√∫blica, deutora per diferents conceptes",
        "Bancs i institucions de cr√®dit", "Caixa", "Capital", "Reserva legal", "Reserves volunt√†ries",
        "Reserves estatut√†ries", 
        "Deutes a llarg termini amb entitats de cr√®dit", "Prove√Ødors d'immobilitzat a llarg termini",
        "Empr√®stits (obligacions i bons a llarg termini)", "Prove√Ødors", "Prove√Ødors, efectes comercials a pagar",
        "Creditors per prestaci√≥ de serveis", "Creditors, efectes comercials a pagar",
        "Hisenda p√∫blica, creditora per conceptes fiscals", "Organismes de la Seguretat Social creditors",
        "Deutes a curt termini amb entitats de cr√®dit", "Prove√Ødors d'immobilitzat a curt termini"
    ];

    let currentAccounts = [];

    // --- GESTI√ì DEL JOC ---
    function startGame() {
        document.getElementById('start-overlay').classList.add('hidden');
        isPlaying = true;
        initGame();
        startTimer();
        updateUI();
    }

    function startTimer() {
        clearInterval(timerInterval);
        
        // --- MODIFICACI√ì: TEMPS M√âS R√ÄPID SEGONS EL NIVELL ---
        // Base: 1000ms. Restem 60ms per nivell. M√≠nim 300ms.
        let velocitat = Math.max(300, 1000 - (currentLevel * 60)); 

        timerInterval = setInterval(() => {
            if (!isPlaying) return;
            timeLeft -= 1;
            updateTimerBar();

            if (timeLeft <= 0) {
                gameOver();
            }
        }, velocitat); 
    }

    function updateTimerBar() {
        const percentage = (timeLeft / MAX_TIME) * 100;
        const bar = document.getElementById('timer-bar');
        bar.style.width = percentage + '%';
        
        if (percentage < 20) bar.style.backgroundColor = '#e74c3c'; 
        else if (percentage < 50) bar.style.backgroundColor = '#f1c40f'; 
        else bar.style.backgroundColor = '#48bb78'; 
    }

    function updateUI() {
        const rankName = currentLevel >= ranks.length ? ranks[ranks.length-1] : ranks[currentLevel];
        document.getElementById('rank-display').innerText = `${currentLevel} - ${rankName}`;
        document.getElementById('score-display').innerText = `${correctCount}`;
    }

    function gameOver() {
        isPlaying = false;
        clearInterval(timerInterval);
        
        const rankName = currentLevel >= ranks.length ? ranks[ranks.length-1] : ranks[currentLevel];
        const imgLevel = Math.min(currentLevel, 10); 

        document.getElementById('final-rank-title').innerText = `NIVELL ${currentLevel}: ${rankName}`;
        document.getElementById('final-score').innerText = correctCount;
        document.getElementById('final-rank-img').src = `nivells/nivell${imgLevel}.jpg`;

        document.getElementById('gameover-overlay').classList.remove('hidden');
    }

    // --- GENERACI√ì DE NIVELL ---
    function initGame() {
        const sourceContainer = document.getElementById('source-container');
        const dropzones = document.querySelectorAll('.document-column .dropzone');
        
        sourceContainer.innerHTML = '';
        dropzones.forEach(dz => dz.innerHTML = '');
        document.getElementById('feedback').style.display = 'none';
        
        updateCalculations();

        // 0. EXCLUSI√ì M√öTUA VARIACI√ì
        const varPositiva = "Variaci√≥ d'exist√®ncies (Ef > Ei)";
        const varNegativa = "Variaci√≥ d'exist√®ncies (Ef < Ei)";
        const allowedVar = Math.random() < 0.5 ? varPositiva : varNegativa;
        const forbiddenVar = allowedVar === varPositiva ? varNegativa : varPositiva;

        // 1. Decidir trampes (0-3)
        let numTraps = Math.floor(Math.random() * 4); 
        
        // 2. Imprescindibles
        const mustHavesNames = ["Vendes de mercaderies", "Compres de mercaderies", "Sous i salaris", "Impost sobre beneficis"];
        let mustHaves = pygDatabase.filter(acc => mustHavesNames.includes(acc.name)).map(acc => ({...acc, type: 'pg'}));

        // 3. Farciment
        let numFillers = 9 - numTraps;
        let remainingPyg = pygDatabase.filter(acc => 
            !mustHavesNames.includes(acc.name) && acc.name !== forbiddenVar
        );
        remainingPyg.sort(() => 0.5 - Math.random());
        let fillers = remainingPyg.slice(0, numFillers).map(acc => ({...acc, type: 'pg'}));

        // 4. Trampes
        let shuffledTraps = balanceSheetTraps.sort(() => 0.5 - Math.random());
        let selectedTraps = shuffledTraps.slice(0, numTraps).map(name => ({
            name: name,
            target: 'trap',
            type: 'bs'
        }));

        // 5. Unir i valors
        currentAccounts = [...mustHaves, ...fillers, ...selectedTraps];
        
        currentAccounts.forEach((acc, index) => {
            acc.id = 'acc-' + index;
            if(acc.name.includes("Vendes")) acc.value = Math.floor(Math.random() * 40000) + 50000;
            else if(acc.name.includes("Compres")) acc.value = Math.floor(Math.random() * 15000) + 10000;
            else if(acc.name.includes("Sous")) acc.value = Math.floor(Math.random() * 10000) + 10000;
            else if(acc.name.includes("Impost")) acc.value = 2500; 
            else if(acc.type === 'bs') acc.value = Math.floor(Math.random() * 5000) + 2000;
            else acc.value = Math.floor(Math.random() * 3000) + 500;
        });

        currentAccounts.sort(() => 0.5 - Math.random());

        // 6. Renderitzar
        currentAccounts.forEach(acc => {
            let el = document.createElement('div');
            el.className = 'account';
            el.id = acc.id;
            el.draggable = true;
            el.innerHTML = `<span>${acc.name}</span><span class="account-val">${acc.value.toLocaleString()} ‚Ç¨</span>`;
            el.ondragstart = drag;
            sourceContainer.appendChild(el);
        });
    }

    // --- DRAG AND DROP ---
    function allowDrop(ev) { ev.preventDefault(); ev.currentTarget.classList.add('dragover'); }
    function drag(ev) { 
        ev.dataTransfer.setData("text", ev.target.id); 
        ev.target.classList.add('dragging');
    }
    
    function drop(ev) {
        ev.preventDefault();
        ev.currentTarget.classList.remove('dragover');
        var data = ev.dataTransfer.getData("text");
        var el = document.getElementById(data);
        if(!el) return;
        el.classList.remove('dragging');
        
        let target = ev.target;
        while (!target.classList.contains('dropzone')) {
            target = target.parentNode;
            if(!target) return; 
        }
        
        target.appendChild(el);
        updateCalculations();
    }

    document.querySelectorAll('.dropzone').forEach(dz => {
        dz.addEventListener('dragleave', (e) => e.currentTarget.classList.remove('dragover'));
    });

    // --- C√ÄLCULS ---
    function updateCalculations() {
        const zones = {
            ing_exp: document.getElementById('zone-ing-exp'),
            des_exp: document.getElementById('zone-des-exp'),
            ing_fin: document.getElementById('zone-ing-fin'),
            des_fin: document.getElementById('zone-des-fin'),
            imp: document.getElementById('zone-imp')
        };

        let totals = { ing_exp: 0, des_exp: 0, ing_fin: 0, des_fin: 0, imp: 0 };

        for (let key in zones) {
            Array.from(zones[key].children).forEach(child => {
                let acc = currentAccounts.find(a => a.id === child.id);
                if (acc) totals[key] += acc.value;
            });
        }

        document.getElementById('total-ing-exp').innerText = totals.ing_exp.toLocaleString() + " ‚Ç¨";
        document.getElementById('total-des-exp').innerText = totals.des_exp.toLocaleString() + " ‚Ç¨";
        document.getElementById('total-ing-fin').innerText = totals.ing_fin.toLocaleString() + " ‚Ç¨";
        document.getElementById('total-des-fin').innerText = totals.des_fin.toLocaleString() + " ‚Ç¨";
        document.getElementById('total-imp').innerText = totals.imp.toLocaleString() + " ‚Ç¨";

        let baii = totals.ing_exp - totals.des_exp;
        let res_fin = totals.ing_fin - totals.des_fin;
        let bai = baii + res_fin;
        let bn = bai - totals.imp;

        formatValue('val-baii', baii);
        formatValue('val-res-fin', res_fin);
        formatValue('val-bai', bai);
        formatValue('val-bn', bn);
    }

    function formatValue(id, val) {
        let el = document.getElementById(id);
        el.innerText = val.toLocaleString() + " ‚Ç¨";
        el.style.color = val >= 0 ? '#48bb78' : '#f56565';
    }

    // --- COMPROVACI√ì CONTRA-RELLOTGE ---
    function checkResult() {
        let errors = [];
        
        const zones = ['ing_exp', 'des_exp', 'ing_fin', 'des_fin', 'imp'];
        
        // 1. Errors de posici√≥
        zones.forEach(z => {
            let zoneEl = document.getElementById('zone-' + z.replace('_', '-'));
            Array.from(zoneEl.children).forEach(child => {
                let acc = currentAccounts.find(a => a.id === child.id);
                if (acc.target === 'trap') errors.push(`‚ö†Ô∏è <b>${acc.name}</b> √©s una trampa (Balan√ß).`);
                else if (acc.target !== z) errors.push(`‚ùå <b>${acc.name}</b> est√† mal col¬∑locat.`);
            });
        });

        // 2. Errors d'oblit
        let sourceEl = document.getElementById('source-container');
        Array.from(sourceEl.children).forEach(child => {
            let acc = currentAccounts.find(a => a.id === child.id);
            if (acc.target !== 'trap') errors.push(`üì• T'has deixat <b>${acc.name}</b>.`);
        });

        let feedbackEl = document.getElementById('feedback');
        feedbackEl.style.display = 'block';

        if (errors.length === 0) {
            // --- ENCERT ---
            correctCount++;
            progressInLevel++;
            
            // L√≤gica de Nivell: Cada 2 encerts puja
            if (progressInLevel >= 2) {
                currentLevel++;
                progressInLevel = 0; 
            }

            timeLeft = Math.min(MAX_TIME, timeLeft + BONUS_TIME);
            updateTimerBar();
            updateUI(); 
            
            // Efecte visual
            document.body.style.backgroundColor = "#d4edda";
            setTimeout(() => document.body.style.backgroundColor = "#f0f2f5", 300);

            initGame(); 
            startTimer(); // --- APLICAR NOVA VELOCITAT ---
        } else {
            // --- ERROR ---
            timeLeft -= PENALTY_TIME;
            updateTimerBar();
            
            document.body.style.backgroundColor = "#f8d7da";
            setTimeout(() => document.body.style.backgroundColor = "#f0f2f5", 300);

            feedbackEl.className = 'error';
            feedbackEl.innerHTML = `<h3>‚ö†Ô∏è -${PENALTY_TIME}s! Errors detectats:</h3><ul>` + errors.map(e => `<li>${e}</li>`).join('') + "</ul>";
        }
    }
</script>
</body>
</html>